<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة البيانات الأكاديمية</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        /* صفحة تسجيل الدخول */
        .login-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 40px;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .login-box h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #000;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        /* صفحة المسؤول */
        .admin-content {
            padding: 30px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-buttons .btn {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        /* صفحة أعضاء الارتباط */
        .member-content {
            padding: 30px;
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info span {
            font-weight: 600;
            color: #667eea;
        }

        .rating-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .rating-excellent { background: #28a745; color: white; }
        .rating-very-good { background: #17a2b8; color: white; }
        .rating-good { background: #ffc107; color: black; }
        .rating-average { background: #fd7e14; color: white; }

        .input-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .export-loading {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .export-options {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- صفحة تسجيل الدخول -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h2>🔐 تسجيل الدخول</h2>
            
            <div class="form-group">
                <label>اسم المستخدم</label>
                <input type="text" id="loginUsername" placeholder="أدخل اسم المستخدم">
            </div>
            <div class="form-group">
                <label>كلمة المرور</label>
                <input type="password" id="loginPassword" placeholder="أدخل كلمة المرور">
            </div>
            <div class="form-group">
                <label>نوع المستخدم</label>
                <select id="loginUserType">
                    <option value="member">عضو ارتباط</option>
                    <option value="admin">مسؤول</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="login()">دخول</button>
            <div id="loginError" class="error-message hidden" style="margin-top: 15px;"></div>
        </div>
    </div>

    <!-- صفحة المسؤول -->
    <div id="adminPage" class="container hidden">
        <div class="header">
            <h1>📊 لوحة تحكم المسؤول</h1>
            <p>إدارة البيانات الأكاديمية</p>
        </div>
        
        <div class="admin-content">
            <div class="user-info">
                <span id="adminWelcome">مرحباً: المسؤول</span>
                <button class="btn btn-secondary" onclick="logout()">تسجيل الخروج</button>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalRecords">0</h3>
                    <p>إجمالي السجلات</p>
                </div>
                <div class="stat-card">
                    <h3 id="todayRecords">0</h3>
                    <p>السجلات اليوم</p>
                </div>
                <div class="stat-card">
                    <h3 id="excellentCount">0</h3>
                    <p>تقييم ممتاز</p>
                </div>
                <div class="stat-card">
                    <h3 id="professorsCount">0</h3>
                    <p>عدد الأساتذة</p>
                </div>
            </div>

            <div class="export-options">
                <h4>📥 خيارات التصدير</h4>
                <p>اختر طريقة التصدير المناسبة:</p>
                <button class="btn btn-success" onclick="exportToCSV()">📊 تصدير CSV (مستحسن)</button>
                <button class="btn btn-warning" onclick="exportToExcel()">📈 تصدير Excel</button>
                <button class="btn btn-primary" onclick="showExportHelp()">ℹ️ مساعدة التصدير</button>
            </div>
            
            <div class="controls">
                <input type="text" id="searchInput" class="search-box" placeholder="ابحث بالاسم أو الإيميل...">
                <button class="btn btn-primary" onclick="searchData()">🔍 بحث</button>
                <button class="btn btn-warning" onclick="addSampleData()">➕ بيانات تجريبية</button>
                <button class="btn btn-danger" onclick="deleteAllData()">🗑️ حذف الكل</button>
            </div>

            <div id="exportLoading" class="export-loading hidden">
                ⏳ جاري تحضير الملف للتصدير...
            </div>
            
            <div id="dataTable"></div>
        </div>
    </div>

    <!-- صفحة أعضاء الارتباط -->
    <div id="memberPage" class="container hidden">
        <div class="header">
            <h1>📝 إدخال البيانات الأكاديمية</h1>
            <p>نموذج رفع البيانات</p>
        </div>
        
        <div class="member-content">
            <div class="user-info">
                <span id="memberName">مرحباً: عضو الارتباط</span>
                <button class="btn btn-secondary" onclick="logout()">تسجيل الخروج</button>
            </div>
            
            <div id="successMsg" class="success-message hidden"></div>
            
            <div class="form-container">
                <form id="dataForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>الاسم الرباعي <span style="color: red;">*</span></label>
                            <input type="text" id="fullName" required placeholder="أدخل الاسم الرباعي الكامل">
                        </div>
                        <div class="form-group">
                            <label>الكلية <span style="color: red;">*</span></label>
                            <input type="text" id="college" required placeholder="أدخل اسم الكلية">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>القسم <span style="color: red;">*</span></label>
                            <input type="text" id="department" required placeholder="أدخل اسم القسم">
                        </div>
                        <div class="form-group">
                            <label>الشهادة <span style="color: red;">*</span></label>
                            <input type="text" id="certificate" required placeholder="مثال: بكالوريوس، ماجستير، دكتوراه">
                            <div class="input-hint">أدخل الشهادة العلمية التي حصل عليها</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>اللقب العلمي <span style="color: red;">*</span></label>
                            <input type="text" id="academicTitle" required placeholder="مثال: مدرس، أستاذ مساعد، أستاذ">
                            <div class="input-hint">أدخل اللقب العلمي الحالي</div>
                        </div>
                        <div class="form-group">
                            <label>التخصص العام <span style="color: red;">*</span></label>
                            <input type="text" id="generalSpecialty" required placeholder="أدخل التخصص العام">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>التخصص الدقيق</label>
                            <input type="text" id="detailedSpecialty" placeholder="أدخل التخصص الدقيق (إن وجد)">
                        </div>
                        <div class="form-group">
                            <label>التشكيل</label>
                            <input type="text" id="formation" placeholder="أدخل التشكيل الإداري">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>درجة التقييم <span style="color: red;">*</span></label>
                            <input type="text" id="rating" required placeholder="مثال: ممتاز، جيد جداً، جيد">
                            <div class="input-hint">أدخل درجة التقييم العام</div>
                        </div>
                        <div class="form-group">
                            <label>الإيميل الرسمي <span style="color: red;">*</span></label>
                            <input type="email" id="email" required placeholder="example@ntu.edu.iq">
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="submitData()">
                        ✅ حفظ البيانات
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // البيانات المخزنة - استخدام localStorage بدلاً من sessionStorage
        let academicData = JSON.parse(localStorage.getItem('academicData')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        
        // حسابات المستخدمين (بدون عرض في الواجهة)
        const users = {
            admin: { username: 'admin', password: 'admin123', type: 'admin', name: 'المسؤول' },
            member1: { username: 'member1', password: 'member123', type: 'member', name: 'عضو الارتباط 1' },
            member2: { username: 'member2', password: 'member123', type: 'member', name: 'عضو الارتباط 2' },
            member3: { username: 'member3', password: 'member123', type: 'member', name: 'عضو الارتباط 3' },
            member4: { username: 'member4', password: 'member123', type: 'member', name: 'عضو الارتباط 4' },
            member5: { username: 'member5', password: 'member123', type: 'member', name: 'عضو الارتباط 5' },
            member6: { username: 'member6', password: 'member123', type: 'member', name: 'عضو الارتباط 6' },
            member7: { username: 'member7', password: 'member123', type: 'member', name: 'عضو الارتباط 7' },
            member8: { username: 'member8', password: 'member123', type: 'member', name: 'عضو الارتباط 8' },
            member9: { username: 'member9', password: 'member123', type: 'member', name: 'عضو الارتباط 9' },
            member10: { username: 'member10', password: 'member123', type: 'member', name: 'عضو الارتباط 10' }
        };
        
        // تحميل البيانات عند بدء الصفحة
        window.onload = function() {
            checkLogin();
        };
        
        // التحقق من تسجيل الدخول
        function checkLogin() {
            if (currentUser) {
                showPage(currentUser.type);
            } else {
                showPage('login');
            }
        }
        
        // تسجيل الدخول
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const userType = document.getElementById('loginUserType').value;
            const errorDiv = document.getElementById('loginError');
            
            let user = null;
            for (let key in users) {
                if (users[key].username === username && 
                    users[key].password === password && 
                    users[key].type === userType) {
                    user = users[key];
                    break;
                }
            }
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                errorDiv.classList.add('hidden');
                showPage(user.type);
            } else {
                errorDiv.textContent = 'اسم المستخدم أو كلمة المرور غير صحيحة';
                errorDiv.classList.remove('hidden');
            }
        }
        
        // تسجيل الخروج
        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            showPage('login');
        }
        
        // عرض الصفحة المناسبة
        function showPage(type) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('memberPage').classList.add('hidden');
            
            if (type === 'login') {
                document.getElementById('loginPage').classList.remove('hidden');
            } else if (type === 'admin') {
                document.getElementById('adminPage').classList.remove('hidden');
                document.getElementById('adminWelcome').textContent = 'مرحباً: ' + currentUser.name;
                displayData();
                updateStats();
            } else if (type === 'member') {
                document.getElementById('memberPage').classList.remove('hidden');
                document.getElementById('memberName').textContent = 'مرحباً: ' + currentUser.name;
            }
        }
        
        // إرسال البيانات (أعضاء الارتباط)
        function submitData() {
            const fullName = document.getElementById('fullName').value;
            const college = document.getElementById('college').value;
            const department = document.getElementById('department').value;
            const certificate = document.getElementById('certificate').value;
            const academicTitle = document.getElementById('academicTitle').value;
            const generalSpecialty = document.getElementById('generalSpecialty').value;
            const detailedSpecialty = document.getElementById('detailedSpecialty').value;
            const formation = document.getElementById('formation').value;
            const rating = document.getElementById('rating').value;
            const email = document.getElementById('email').value;
            
            // التحقق من الحقول المطلوبة
            if (!fullName || !college || !department || !certificate || !academicTitle || !generalSpecialty || !rating || !email) {
                alert('⚠️ يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            const newRecord = {
                id: Date.now(),
                fullName: fullName,
                college: college,
                department: department,
                certificate: certificate,
                academicTitle: academicTitle,
                generalSpecialty: generalSpecialty,
                detailedSpecialty: detailedSpecialty,
                formation: formation,
                rating: rating,
                email: email,
                submittedBy: currentUser.name,
                submittedAt: new Date().toISOString()
            };
            
            academicData.push(newRecord);
            localStorage.setItem('academicData', JSON.stringify(academicData));
            
            // عرض رسالة النجاح
            const successMsg = document.getElementById('successMsg');
            successMsg.textContent = '✅ تم حفظ البيانات بنجاح!';
            successMsg.classList.remove('hidden');
            
            // إعادة تعيين النموذج
            document.getElementById('dataForm').reset();
            
            // إخفاء رسالة النجاح بعد 3 ثواني
            setTimeout(() => {
                successMsg.classList.add('hidden');
            }, 3000);
        }
        
        // عرض البيانات (المسؤول)
        function displayData(data = academicData) {
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>الاسم الرباعي</th>
                            <th>الكلية</th>
                            <th>القسم</th>
                            <th>الشهادة</th>
                            <th>اللقب العلمي</th>
                            <th>التخصص العام</th>
                            <th>درجة التقييم</th>
                            <th>الإيميل</th>
                            <th>أدخل بواسطة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (data.length === 0) {
                tableHTML += `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 30px; color: #999;">
                            لا توجد بيانات لعرضها
                        </td>
                    </tr>
                `;
            } else {
                data.forEach(record => {
                    const ratingClass = getRatingClass(record.rating);
                    tableHTML += `
                        <tr>
                            <td><strong>${record.fullName}</strong></td>
                            <td>${record.college}</td>
                            <td>${record.department}</td>
                            <td>${record.certificate}</td>
                            <td>${record.academicTitle}</td>
                            <td>${record.generalSpecialty}</td>
                            <td><span class="rating-badge ${ratingClass}">${record.rating}</span></td>
                            <td>${record.email}</td>
                            <td>${record.submittedBy || '-'}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-warning" onclick="editRecord(${record.id})">تعديل</button>
                                    <button class="btn btn-danger" onclick="deleteRecord(${record.id})">حذف</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tableHTML += `</tbody></table>`;
            document.getElementById('dataTable').innerHTML = tableHTML;
        }

        // الحصول على كلاس التقييم
        function getRatingClass(rating) {
            const ratingLower = rating.toLowerCase();
            if (ratingLower.includes('ممتاز')) return 'rating-excellent';
            if (ratingLower.includes('جيد جداً') || ratingLower.includes('جيد جدا')) return 'rating-very-good';
            if (ratingLower.includes('جيد')) return 'rating-good';
            if (ratingLower.includes('متوسط')) return 'rating-average';
            return '';
        }
        
        // تحديث الإحصائيات
        function updateStats() {
            document.getElementById('totalRecords').textContent = academicData.length;
            
            const today = new Date().toDateString();
            const todayCount = academicData.filter(r => {
                if (!r.submittedAt) return false;
                const recordDate = new Date(r.submittedAt).toDateString();
                return recordDate === today;
            }).length;
            document.getElementById('todayRecords').textContent = todayCount;

            // إحصائيات إضافية
            const excellentCount = academicData.filter(r => 
                r.rating.toLowerCase().includes('ممتاز')).length;
            document.getElementById('excellentCount').textContent = excellentCount;

            const professorsCount = academicData.filter(r => 
                r.academicTitle.toLowerCase().includes('أستاذ')).length;
            document.getElementById('professorsCount').textContent = professorsCount;
        }
        
        // البحث
        function searchData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = academicData.filter(record => 
                record.fullName.toLowerCase().includes(searchTerm) ||
                record.email.toLowerCase().includes(searchTerm) ||
                record.college.toLowerCase().includes(searchTerm) ||
                record.department.toLowerCase().includes(searchTerm) ||
                record.certificate.toLowerCase().includes(searchTerm) ||
                record.academicTitle.toLowerCase().includes(searchTerm)
            );
            displayData(filteredData);
        }
        
        // حذف سجل
        function deleteRecord(id) {
            if (confirm('هل أنت متأكد من حذف هذا السجل؟')) {
                academicData = academicData.filter(record => record.id !== id);
                localStorage.setItem('academicData', JSON.stringify(academicData));
                displayData();
                updateStats();
                alert('✅ تم حذف السجل بنجاح');
            }
        }
        
        // تعديل سجل
        function editRecord(id) {
            const record = academicData.find(r => r.id === id);
            if (record) {
                const newName = prompt('الاسم الرباعي:', record.fullName);
                const newEmail = prompt('الإيميل:', record.email);
                const newCertificate = prompt('الشهادة:', record.certificate);
                const newAcademicTitle = prompt('اللقب العلمي:', record.academicTitle);
                const newRating = prompt('درجة التقييم:', record.rating);
                
                if (newName !== null) {
                    record.fullName = newName;
                    record.email = newEmail || record.email;
                    record.certificate = newCertificate || record.certificate;
                    record.academicTitle = newAcademicTitle || record.academicTitle;
                    record.rating = newRating || record.rating;
                    
                    localStorage.setItem('academicData', JSON.stringify(academicData));
                    displayData();
                    alert('✅ تم تعديل السجل بنجاح');
                }
            }
        }

        // إضافة بيانات تجريبية
        function addSampleData() {
            const sampleData = [
                {
                    id: Date.now() + 1,
                    fullName: "أحمد محمد علي",
                    college: "كلية الهندسة",
                    department: "هندسة الحاسوب",
                    certificate: "دكتوراه",
                    academicTitle: "أستاذ",
                    generalSpecialty: "هندسة البرمجيات",
                    detailedSpecialty: "أمن المعلومات",
                    formation: "التعليم العالي",
                    rating: "ممتاز",
                    email: "ahmed@ntu.edu.iq",
                    submittedBy: "النظام",
                    submittedAt: new Date().toISOString()
                },
                {
                    id: Date.now() + 2,
                    fullName: "فاطمة حسن عبدالله",
                    college: "كلية العلوم",
                    department: "علوم الحاسوب",
                    certificate: "ماجستير",
                    academicTitle: "أستاذ مساعد",
                    generalSpecialty: "الذكاء الاصطناعي",
                    detailedSpecialty: "تعلم الآلة",
                    formation: "البحث العلمي",
                    rating: "جيد جداً",
                    email: "fatima@ntu.edu.iq",
                    submittedBy: "النظام",
                    submittedAt: new Date().toISOString()
                }
            ];

            academicData = [...academicData, ...sampleData];
            localStorage.setItem('academicData', JSON.stringify(academicData));
            displayData();
            updateStats();
            alert('✅ تم إضافة البيانات التجريبية بنجاح');
        }
        
        // حذف جميع البيانات
        function deleteAllData() {
            if (confirm('⚠️ تحذير: هل أنت متأكد من حذف جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه!')) {
                if (confirm('تأكيد نهائي: سيتم حذف جميع السجلات نهائياً!')) {
                    academicData = [];
                    localStorage.setItem('academicData', JSON.stringify(academicData));
                    displayData();
                    updateStats();
                    alert('✅ تم حذف جميع البيانات بنجاح');
                }
            }
        }

        // تصدير إلى CSV - الطريقة المضمونة
        function exportToCSV() {
            if (academicData.length === 0) {
                alert('لا توجد بيانات للتصدير');
                return;
            }

            const loadingDiv = document.getElementById('exportLoading');
            loadingDiv.classList.remove('hidden');

            setTimeout(() => {
                try {
                    // العناوين بالعربية
                    const headers = [
                        'الاسم الرباعي',
                        'الكلية', 
                        'القسم',
                        'الشهادة',
                        'اللقب العلمي',
                        'التخصص العام',
                        'التخصص الدقيق',
                        'التشكيل',
                        'درجة التقييم',
                        'الإيميل',
                        'أدخل بواسطة',
                        'تاريخ الإدخال'
                    ];

                    // إنشاء محتوى CSV
                    let csvContent = '';
                    
                    // إضافة العناوين
                    csvContent += headers.join(';') + '\n';
                    
                    // إضافة البيانات
                    academicData.forEach(record => {
                        const row = [
                            cleanForCSV(record.fullName),
                            cleanForCSV(record.college),
                            cleanForCSV(record.department),
                            cleanForCSV(record.certificate),
                            cleanForCSV(record.academicTitle),
                            cleanForCSV(record.generalSpecialty),
                            cleanForCSV(record.detailedSpecialty || ''),
                            cleanForCSV(record.formation || ''),
                            cleanForCSV(record.rating),
                            cleanForCSV(record.email),
                            cleanForCSV(record.submittedBy || ''),
                            record.submittedAt ? new Date(record.submittedAt).toLocaleDateString('ar-IQ') : ''
                        ];
                        csvContent += row.join(';') + '\n';
                    });

                    // استخدام الفاصلة المنقوطة بدلاً من الفاصلة للتوافق مع Excel العربي
                    const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.href = url;
                    
                    const today = new Date().toISOString().split('T')[0];
                    link.download = `academic_data_${today}.csv`;
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    loadingDiv.classList.add('hidden');
                    alert('✅ تم تصدير البيانات بنجاح! استخدم الفاصلة المنقوطة (;) كفاصل عند الاستيراد في Excel.');
                    
                } catch (error) {
                    console.error('خطأ في التصدير:', error);
                    loadingDiv.classList.add('hidden');
                    alert('❌ حدث خطأ أثناء التصدير: ' + error.message);
                }
            }, 500);
        }

        // تصدير إلى Excel باستخدام مكتبة SheetJS
        function exportToExcel() {
            if (academicData.length === 0) {
                alert('لا توجد بيانات للتصدير');
                return;
            }

            const loadingDiv = document.getElementById('exportLoading');
            loadingDiv.classList.remove('hidden');

            setTimeout(() => {
                try {
                    // إنشاء بيانات Excel يدوياً
                    let excelContent = 'الاسم الرباعي\tالكلية\tالقسم\tالشهادة\tاللقب العلمي\tالتخصص العام\tالتخصص الدقيق\tالتشكيل\tدرجة التقييم\tالإيميل\tأدخل بواسطة\tتاريخ الإدخال\n';
                    
                    academicData.forEach(record => {
                        excelContent += 
                            (record.fullName || '') + '\t' +
                            (record.college || '') + '\t' +
                            (record.department || '') + '\t' +
                            (record.certificate || '') + '\t' +
                            (record.academicTitle || '') + '\t' +
                            (record.generalSpecialty || '') + '\t' +
                            (record.detailedSpecialty || '') + '\t' +
                            (record.formation || '') + '\t' +
                            (record.rating || '') + '\t' +
                            (record.email || '') + '\t' +
                            (record.submittedBy || '') + '\t' +
                            (record.submittedAt ? new Date(record.submittedAt).toLocaleDateString('ar-IQ') : '') + '\n';
                    });

                    const blob = new Blob(['\uFEFF' + excelContent], { type: 'text/plain;charset=utf-8' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.href = url;
                    
                    const today = new Date().toISOString().split('T')[0];
                    link.download = `academic_data_${today}.xls`;
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    loadingDiv.classList.add('hidden');
                    alert('✅ تم تصدير البيانات بنجاح! افتح الملف في Excel.');
                    
                } catch (error) {
                    console.error('خطأ في التصدير:', error);
                    loadingDiv.classList.add('hidden');
                    alert('❌ حدث خطأ أثناء التصدير. جرب تصدير CSV بدلاً من ذلك.');
                }
            }, 500);
        }

        // تنظيف البيانات للتصدير
        function cleanForCSV(text) {
            if (!text) return '';
            // إزالة الفواصل والفواصل المنقوطة التي قد تسبب مشاكل
            return String(text).replace(/[,;]/g, ' ').replace(/\n/g, ' ').replace(/\r/g, ' ').trim();
        }

        // عرض مساعدة التصدير
        function showExportHelp() {
            alert(`💡 مساعدة التصدير:

1. 📊 تصدير CSV (مستحسن):
   - ينشئ ملف CSV يمكن فتحه في Excel
   - استخدم الفاصلة المنقوطة (;) كفاصل
   - يدعم النصوص العربية بشكل أفضل

2. 📈 تصدير Excel:
   - ينشئ ملف Excel مباشرة
   - قد يحتاج إلى تعديل إعدادات اللغة

3. إذا كانت البيانات تظهر في عمود واحد:
   - في Excel: بيانات → نص إلى أعمدة → اختر الفاصل المناسب
   - استخدم الفاصلة المنقوطة (;) كفاصل
            `);
        }

        // إضافة بيانات أولية إذا لم تكن موجودة
        if (academicData.length === 0) {
            addSampleData();
        }
    </script>
</body>
</html>